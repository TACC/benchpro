#!/bin/bash 

ml reset 
ml intel/18.0.2
ml impi/18.0.2
ml 

export   MPICC=mpicc
export  MPICXX=mpicxx
export MPIFORT=mpifort
export  MPIF90=mpif90
export      CC=icc
export     CXX=icpc
export      FC=ifort
export     F77=ifort
export     F90=ifort


export     build_path=/scratch/06280/mcawood/bench-framework/build/stampede2/skylake/intel18/impi18/lammps/3Mar20/default/build
export   install_path=/scratch/06280/mcawood/bench-framework/build/stampede2/skylake/intel18/impi18/lammps/3Mar20/default/install
export benchmark_repo=/scratch/06280/mcawood/benchmark_repo
export       compiler=intel/18.0.2
export            mpi=impi/18.0.2
export        version=3Mar20
export      opt_flags=
export            exe=lmp_intel_cpu_intelmpi

date
echo "Slurm Job ID: ${SLURM_JOB_ID}"
echo "Host: ${HOSTNAME}"
echo "User: ${USER}"

mkdir -p ${build_path}

tar -xf ${benchmark_repo}/lammps-${version}.tgz -C ${build_path}

cd ${build_path}/lammps-${version}/src

make yes-user-intel
make yes-user-omp

make package-status

make intel_cpu_intelmpi -j 8

mkdir -p ${install_path} && cp ${exe} ${install_path}

date
ldd $(which lmp_intel_cpu_intelmpi) 
/scratch/06280/mcawood/bench-framework/src/collect_hw_info.sh /scratch/06280/mcawood/bench-framework/hw_utils /scratch/06280/mcawood/bench-framework/build/stampede2/skylake/intel18/impi18/lammps/3Mar20/default/hw_report
